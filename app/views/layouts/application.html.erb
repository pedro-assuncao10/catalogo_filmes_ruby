<!DOCTYPE html>
<html>
  <head>
    <title>Catálogo</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Favicons -->
    <%= favicon_link_tag "logo1.png", rel: "icon", type: "image/png", sizes: "32x32" %>
    <%= favicon_link_tag "logo1.png", rel: "icon", type: "image/png", sizes: "16x16" %>
    <%# Opcional: ícone Apple/Android se você tiver os arquivos %>
    <%#= favicon_link_tag "apple-touch-icon.png", rel: "apple-touch-icon", sizes: "180x180" %>
    <%#= favicon_link_tag "android-chrome-192.png", rel: "icon", type: "image/png", sizes: "192x192" %>
    <%#= favicon_link_tag "android-chrome-512.png", rel: "icon", type: "image/png", sizes: "512x512" %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%# Importmap (Rails 7+) - garante que os módulos JS sejam carregados %>
    <%= javascript_importmap_tags %>
  </head>
  <body class="theme-dark">
    <div class="app-container">
      <aside class="sidebar" data-sidebar>
        <div class="sidebar-header">
          <button class="sidebar-toggle" aria-label="Abrir/fechar menu" data-sidebar-toggle>
            <span class="bar"></span><span class="bar"></span><span class="bar"></span>
          </button>
          <div class="logo">CATÁLOGO</div>
        </div>

        <nav class="menu">
          <%= link_to root_path, class: "menu-item" do %>
            <i class="ni ni-home"></i>
            <span>Início</span>
          <% end %>

          <%= link_to new_movie_path, class: "menu-item" do %>
            <i class="ni ni-plus"></i>
            <span>Cadastrar Novo Filme</span>
          <% end %>

          <%= link_to categories_path, class: "menu-item" do %>
            <i class="ni ni-folder"></i>
            <span>Gerenciar Categorias</span>
          <% end %>

          <%= link_to edit_user_registration_path, class: "menu-item" do %>
            <i class="ni ni-user"></i>
            <span>Editar Perfil</span>
          <% end %>

          <%= link_to destroy_user_session_path, data: { turbo_method: :delete }, class: "menu-item danger" do %>
            <i class="ni ni-exit"></i>
            <span>Sair</span>
          <% end %>
        </nav>

        <!-- Busca no menu -->
        <div class="menu-search">
          <%= form_with(url: root_path, method: :get, local: true, html: { class: "filter-form" }) do |form| %>
            <label class="field">
              <i class="ni ni-search"></i>
              <%= form.text_field :query, value: params[:query], placeholder: "Buscar título ou diretor" %>
            </label>

            <label class="field">
              <i class="ni ni-calendar"></i>
              <%= form.text_field :year, value: params[:year], placeholder: "Ano" %>
            </label>

            <%# Fallback seguro: usa Category.none quando @categories for nil %>
            <label class="field select">
              <i class="ni ni-tag"></i>
              <%= form.collection_select :category_id,
                    (@categories || Category.none), :id, :name,
                    { include_blank: 'Todas as categorias' },
                    { value: params[:category_id] } %>
            </label>

            <button class="btn-primary" type="submit">
              <i class="ni ni-filter"></i> Filtrar
            </button>
          <% end %>
        </div>
      </aside>

      <main class="main-content">
        <%= yield %>
      </main>
    </div>
    
    <%# Método direto: Carrega o sidebar.js via Asset Pipeline %>
    <%= javascript_include_tag "sidebar", defer: true %>
  </body>
</html>
